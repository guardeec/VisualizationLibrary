<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
</head>
<body>

<script type="text/javascript">

    var color = d3.scale.category10(),
            paddingMatrix = 20,
            width = 500+paddingMatrix,
            height = 500+paddingMatrix,
            paddingLines = 1;

    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            ;

    d3.json("miserables.json", function(d) {

        var nodesNumber = d.nodes.length;

        svg.append("rect")
                .attr("class", "background")
                .attr("width", width)
                .attr("height", height)
                .attr("x", 0)
                .attr("y", 0)
                .style("fill", "grey")
                .style("opacity", 0.15)
        ;

        svg.selectAll("background")
                .data(d.nodes)
                .enter()
                .append("rect")
                .attr("class", "column")
                .attr("width", paddingLines)
                .attr("height", height)
                .attr("x", function(d){
                    return d.id*width/nodesNumber;
                })
                .attr("y", 0)
                .style("fill", "white")
        ;

        svg.selectAll("g")
                .data(d.nodes)
                .enter()
                .append("rect")
                .attr("class", "column")
                .attr("width", width)
                .attr("height", paddingLines)
                .attr("x", 0)
                .attr("y", function(d){
                    return d.id*height/nodesNumber;
                })
                .style("fill", "white")
        ;


       svg.selectAll("g")
               .data(d.links)
               .enter()
               .append("rect")
               .attr("class", "cell")
               .attr("width", width/nodesNumber-paddingLines)
               .attr("height", height/nodesNumber-paddingLines)

               .attr("x", function(d){
                   return d.sourse*width/nodesNumber+paddingLines;
               })
               .attr("y", function(d){
                   return d.target*height/nodesNumber+paddingLines;
               })
               .style("fill", function(d){
                   return color(d.color);
               })
               .style("opacity", function(d){
                   return d.opacity;
               })
               ;
    });



</script>


